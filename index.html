<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI MAKER - ULTIMATE FIX</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden { display: none; }
        body { background: #05070a; color: #e2e8f0; font-family: sans-serif; }
        .btn-main { background: #1e293b; border: 1px solid #334155; transition: 0.2s; }
        .btn-main:hover { border-color: #3b82f6; background: #0f172a; }
        .loader { border-top-color: #3b82f6; animation: spinner 0.6s linear infinite; }
        @keyframes spinner { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="p-4">

    <div id="app" class="max-w-lg mx-auto">
        <div id="screen-home" class="space-y-6">
            <header class="text-center py-6">
                <h1 class="text-3xl font-black italic text-blue-500">AI MAKER HUB</h1>
                <p class="text-[10px] text-gray-500 tracking-[0.2em]">ULTIMATE SCRIPT GENERATOR</p>
            </header>

            <button onclick="showScreen('screen-settings')" class="w-full p-4 rounded-xl border border-dashed border-gray-700 text-sm flex justify-between items-center">
                <span>⚙️ Konfigurasi API</span>
                <span id="key-indicator" class="text-red-500 text-[10px]">● DISCONNECTED</span>
            </button>

            <div class="grid gap-3">
                <button onclick="prepareReq('ROBLOX CUSTOM LUA MAKER')" class="btn-main p-5 rounded-2xl text-left font-bold">ROBLOX LUA MAKER</button>
                <button onclick="prepareReq('GROWTOPIA CUSTOM LUA MAKER')" class="btn-main p-5 rounded-2xl text-left font-bold">GROWTOPIA LUA MAKER</button>
                <button onclick="prepareReq('AI MAKER CUSTOM IMAGE')" class="btn-main p-5 rounded-2xl text-left font-bold">AI IMAGE MAKER</button>
                <button onclick="showScreen('screen-converter')" class="btn-main p-5 rounded-2xl text-left font-bold">AI CONVERTER</button>
                <button onclick="showScreen('screen-gtps')" class="btn-main p-5 rounded-2xl text-left font-bold">AI GTPS LUA MAKER</button>
                <button onclick="prepareReq('AI ROBLOX GAME MAKER')" class="btn-main p-5 rounded-2xl text-left font-bold">AI ROBLOX GAME MAKER</button>
            </div>
        </div>

        <div id="screen-settings" class="hidden space-y-4">
            <h2 class="text-xl font-bold">SETTINGS</h2>
            <div class="bg-gray-900 p-5 rounded-2xl border border-gray-800">
                <label class="text-xs text-gray-400">Gemini API Key:</label>
                <input type="password" id="api-key-input" class="w-full bg-black p-3 rounded-lg mt-2 border border-gray-700 outline-none focus:border-blue-500 text-sm">
                <p class="text-[9px] text-gray-500 mt-2">Dapatkan di aistudio.google.com</p>
            </div>
            <button onclick="saveKey()" class="w-full bg-blue-600 p-4 rounded-xl font-bold">SIMPAN & BACK</button>
        </div>

        <div id="screen-request" class="hidden space-y-4">
            <div class="flex justify-between items-center">
                <button onclick="showScreen('screen-home')" class="text-sm text-gray-400">← Back</button>
                <span id="active-title" class="text-xs font-bold text-blue-400"></span>
            </div>
            <textarea id="user-prompt" rows="5" class="w-full bg-gray-900 p-4 rounded-2xl border border-gray-800 outline-none focus:border-blue-500 text-sm" placeholder="Tulis instruksi..."></textarea>
            <button onclick="executeAI()" id="run-btn" class="w-full bg-blue-600 p-4 rounded-xl font-bold flex justify-center items-center gap-2">
                <span>GENERATE SCRIPT</span>
                <div id="spinner" class="hidden w-4 h-4 border-2 border-white rounded-full loader"></div>
            </button>
            <div class="space-y-2">
                <div class="flex justify-between text-[10px] text-gray-500 font-bold uppercase">
                    <span>Result:</span>
                    <button onclick="copyRes()">Copy</button>
                </div>
                <div id="ai-result" class="bg-black border border-gray-800 p-4 rounded-2xl font-mono text-[11px] text-green-400 overflow-x-auto min-h-[200px] whitespace-pre-wrap">Silahkan generate...</div>
            </div>
        </div>

        <div id="screen-converter" class="hidden text-center py-10">
            <p>Fitur Converter memerlukan API Server-Side.</p>
            <button onclick="showScreen('screen-home')" class="mt-4 text-blue-500">Kembali</button>
        </div>
        <div id="screen-gtps" class="hidden space-y-4">
            <h2 class="text-center font-bold">PILIH SERVER</h2>
            <button onclick="prepareReq('GTPS GROWSOFT')" class="w-full p-6 bg-blue-900/20 border border-blue-500 rounded-2xl font-bold">GROWSOFT</button>
            <button onclick="prepareReq('GTPS RDP/VPS')" class="w-full p-6 bg-gray-900 border border-gray-700 rounded-2xl font-bold">RDP / VPS</button>
            <button onclick="showScreen('screen-home')" class="w-full text-gray-500 text-sm">Kembali</button>
        </div>
    </div>

    <script>
        function showScreen(id) {
            document.querySelectorAll('#app > div').forEach(s => s.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        function saveKey() {
            const key = document.getElementById('api-key-input').value;
            localStorage.setItem('my_gemini_key', key);
            checkKey();
            showScreen('screen-home');
        }

        function checkKey() {
            const key = localStorage.getItem('my_gemini_key');
            if(key) {
                document.getElementById('key-indicator').innerHTML = "● CONNECTED";
                document.getElementById('key-indicator').className = "text-green-500 text-[10px]";
                document.getElementById('api-key-input').value = key;
            }
        }

        function prepareReq(title) {
            if(!localStorage.getItem('my_gemini_key')) return alert("Isi API KEY di Settings!");
            document.getElementById('active-title').innerText = title;
            document.getElementById('ai-result').innerText = "Menunggu input...";
            showScreen('screen-request');
        }

        async function executeAI() {
            const key = localStorage.getItem('my_gemini_key');
            const title = document.getElementById('active-title').innerText;
            const prompt = document.getElementById('user-prompt').value;
            const resDiv = document.getElementById('ai-result');
            const btn = document.getElementById('run-btn');
            const spin = document.getElementById('spinner');

            if(!prompt) return alert("Masukkan request!");

            btn.disabled = true;
            spin.classList.remove('hidden');
            resDiv.innerText = "Processing...";

            // DAFTAR MODEL YANG AKAN DICOBA (FALLBACK SYSTEM)
            const models = ["gemini-1.5-flash", "gemini-pro"];
            let success = false;

            for(let model of models) {
                if(success) break;
                try {
                    const resp = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${key}`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: `Role: Expert ${title}. Request: ${prompt}` }] }]
                        })
                    });

                    const data = await resp.json();
                    
                    if(data.candidates && data.candidates[0].content.parts[0].text) {
                        resDiv.innerText = data.candidates[0].content.parts[0].text;
                        success = true;
                    } else if (data.error) {
                        console.error(`Error on ${model}:`, data.error.message);
                    }
                } catch (e) {
                    console.error("Fetch error:", e);
                }
            }

            if(!success) {
                resDiv.innerText = "❌ GAGAL MENGHUBUNGI AI.\n\nSolusi:\n1. Gunakan VPN (Kadang Google memblokir IP tertentu).\n2. Pastikan API KEY benar.\n3. Pastikan API KEY sudah di-enable 'Gemini API' di Google Cloud Console.";
            }

            btn.disabled = false;
            spin.classList.add('hidden');
        }

        function copyRes() {
            navigator.clipboard.writeText(document.getElementById('ai-result').innerText);
            alert("Disalin!");
        }

        checkKey();
    </script>
</body>
</html>
