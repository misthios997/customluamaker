<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI MAKER - AUTO DETECT VERSION</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden { display: none; }
        body { background: #050505; color: #eee; font-family: 'Inter', sans-serif; }
        .card-glass { background: #111; border: 1px solid #222; border-radius: 20px; transition: 0.3s; }
        .card-glass:hover { border-color: #3b82f6; background: #161616; }
        .input-dark { background: #000; border: 1px solid #333; color: white; border-radius: 12px; }
        .input-dark:focus { border-color: #3b82f6; outline: none; }
        .btn-grad { background: linear-gradient(90deg, #3b82f6, #8b5cf6); transition: 0.3s; }
        .btn-grad:hover { opacity: 0.9; transform: scale(0.98); }
        .shimmer { background: linear-gradient(90deg, #111 25%, #222 50%, #111 75%); background-size: 200% 100%; animation: loading 1.5s infinite linear; }
        @keyframes loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    </style>
</head>
<body class="p-4">

    <div id="app" class="max-w-md mx-auto">
        
        <div id="screen-home" class="space-y-6">
            <header class="text-center py-10">
                <h1 class="text-3xl font-black tracking-tighter text-white italic">AI MAKER HUB</h1>
                <div id="api-status" class="text-[10px] mt-2 inline-block px-3 py-1 rounded-full bg-red-900/30 text-red-500 font-bold border border-red-900">API: DISCONNECTED</div>
            </header>

            <div class="grid gap-3">
                <button onclick="showScreen('screen-settings')" class="card-glass p-4 text-sm flex justify-between items-center font-bold">
                    <span>⚙️ CONFIGURATION</span>
                    <span>→</span>
                </button>

                <div class="pt-4 grid gap-3">
                    <button onclick="openRequest('ROBLOX LUA MAKER')" class="card-glass p-5 text-left font-bold border-l-4 border-l-blue-500">ROBLOX CUSTOM LUA</button>
                    <button onclick="openRequest('GROWTOPIA LUA MAKER')" class="card-glass p-5 text-left font-bold border-l-4 border-l-green-500">GROWTOPIA CUSTOM LUA</button>
                    <button onclick="showScreen('screen-converter')" class="card-glass p-5 text-left font-bold border-l-4 border-l-yellow-500 text-yellow-500">AI CONVERTER</button>
                    <button onclick="showScreen('screen-gtps')" class="card-glass p-5 text-left font-bold border-l-4 border-l-orange-500">AI GTPS LUA MAKER</button>
                </div>
            </div>
        </div>

        <div id="screen-settings" class="hidden space-y-4">
            <button onclick="showScreen('screen-home')" class="text-sm text-gray-500">← Back</button>
            <h2 class="text-2xl font-bold">Settings</h2>
            <div class="card-glass p-6 space-y-4">
                <div>
                    <label class="text-xs text-gray-400 font-bold uppercase">Google Gemini API Key</label>
                    <input type="password" id="api-key" placeholder="Paste your key..." class="w-full mt-2 p-4 input-dark text-sm">
                </div>
                <button onclick="saveKey()" class="w-full btn-grad p-4 rounded-xl font-bold">SAVE & ACTIVATE</button>
            </div>
        </div>

        <div id="screen-request" class="hidden space-y-4">
            <div class="flex items-center gap-3">
                <button onclick="goBack()" class="p-2 card-glass text-xs">← BACK</button>
                <h2 id="title-text" class="font-bold text-blue-400 uppercase text-xs"></h2>
            </div>
            
            <textarea id="prompt-input" rows="5" class="w-full input-dark p-4 text-sm" placeholder="Tulis fitur yang ingin dibuat..."></textarea>
            
            <button onclick="callAI()" id="btn-gen" class="w-full btn-grad p-4 rounded-2xl font-black uppercase tracking-widest shadow-lg shadow-blue-500/20">GENERATE</button>

            <div class="space-y-2">
                <div class="flex justify-between items-center text-[10px] font-bold text-gray-500">
                    <span>RESULT:</span>
                    <button onclick="copyOutput()" class="text-blue-500">COPY</button>
                </div>
                <pre id="output-box" class="card-glass p-5 font-mono text-[11px] text-green-400 overflow-x-auto min-h-[250px] whitespace-pre-wrap bg-black border-none">Ready...</pre>
            </div>
        </div>

        <div id="screen-gtps" class="hidden space-y-3">
            <button onclick="showScreen('screen-home')" class="text-sm">← Back</button>
            <button onclick="openRequest('GTPS GROWSOFT LUA')" class="w-full card-glass p-6 text-center font-bold border-blue-600/30">GROWSOFT</button>
            <button onclick="openRequest('GTPS RDP/VPS LUA')" class="w-full card-glass p-6 text-center font-bold border-gray-600/30">RDP / VPS</button>
        </div>

        <div id="screen-converter" class="hidden space-y-3">
            <button onclick="showScreen('screen-home')" class="text-sm">← Back</button>
            <div class="card-glass p-6 text-center">
                <h2 class="font-bold text-yellow-500">CONVERTER</h2>
                <p class="text-[10px] text-gray-500 mt-2 italic">Fitur ini butuh server. Gunakan "AI SCRIPT MAKER" untuk minta kode Python/NodeJS converternya.</p>
            </div>
        </div>
    </div>

    <script>
        function showScreen(id) {
            document.querySelectorAll('#app > div').forEach(d => d.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        function saveKey() {
            const key = document.getElementById('api-key').value.trim();
            if(!key) return alert("Key kosong!");
            localStorage.setItem('gem_key', key);
            updateBadge();
            showScreen('screen-home');
        }

        function updateBadge() {
            const k = localStorage.getItem('gem_key');
            const b = document.getElementById('api-status');
            if(k) {
                b.innerText = "API: CONNECTED";
                b.className = "text-[10px] mt-2 inline-block px-3 py-1 rounded-full bg-green-900/30 text-green-500 font-bold border border-green-900";
            }
        }

        function openRequest(title) {
            if(!localStorage.getItem('gem_key')) return alert("Isi API KEY di Settings!");
            document.getElementById('title-text').innerText = title;
            document.getElementById('output-box').innerText = "Silahkan ketik request...";
            showScreen('screen-request');
        }

        function goBack() {
            const t = document.getElementById('title-text').innerText;
            if(t.includes('GTPS')) showScreen('screen-gtps');
            else showScreen('screen-home');
        }

        // --- FUNGSI UTAMA BYPASS ---
        async function callAI() {
            const key = localStorage.getItem('gem_key');
            const prompt = document.getElementById('prompt-input').value;
            const title = document.getElementById('title-text').innerText;
            const output = document.getElementById('output-box');
            const btn = document.getElementById('btn-gen');

            if(!prompt) return alert("Isi request!");

            btn.disabled = true;
            btn.innerText = "PROCESSING...";
            output.innerText = "Mencoba beberapa model AI Google...";
            output.classList.add('shimmer');

            // Kita coba 3 variasi endpoint yang sering berubah-ubah di tiap wilayah
            const models = [
                { url: "v1beta/models/gemini-1.5-flash", name: "1.5 Flash Beta" },
                { url: "v1beta/models/gemini-pro", name: "Pro Beta" },
                { url: "v1/models/gemini-pro", name: "Pro Stable" }
            ];

            let success = false;

            for (let m of models) {
                if(success) break;
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/${m.url}:generateContent?key=${key}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: `Expert Mode: ${title}. Request: ${prompt}` }] }]
                        })
                    });

                    const data = await response.json();
                    if(data.candidates) {
                        output.innerText = data.candidates[0].content.parts[0].text;
                        success = true;
                        console.log("Success using model: " + m.name);
                    }
                } catch (e) {
                    console.error("Model " + m.name + " failed.");
                }
            }

            if(!success) {
                output.innerText = "❌ ERROR: Semua model Google gagal merespon.\n\nSOLUSI TERBAIK:\n1. Buka situs aistudio.google.com\n2. Cek apakah API Key Anda aktif.\n3. Gunakan VPN (U.S atau Singapore) lalu refresh halaman ini.";
            }

            btn.disabled = false;
            btn.innerText = "GENERATE";
            output.classList.remove('shimmer');
        }

        function copyOutput() {
            navigator.clipboard.writeText(document.getElementById('output-box').innerText);
            alert("Disalin!");
        }

        // Init
        updateBadge();
        if(localStorage.getItem('gem_key')) document.getElementById('api-key').value = localStorage.getItem('gem_key');
    </script>
</body>
</html>
